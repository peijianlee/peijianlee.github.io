{"_path":"/posts/20211028","_dir":"posts","_draft":false,"_partial":false,"_locale":"","title":"前端微服务-qiankun安装与配置","description":"","navigation":{"title":"前端微服务-qiankun安装与配置","description":"qiankun 孵化自蚂蚁金融科技基于微前端架构的云产品统一接入平台，在经过一批线上应用的充分检验及打磨后，我们将其微前端内核抽取出来并开源，希望能同时帮助社区有类似需求的系统更方便的构建自己的微前端系统，同时也希望通过社区的帮助将 qiankun 打磨的更加成熟完善。","date":"2021-10-28 10:20:00","account":"lpj","tags":["前端微服务","乾坤"]},"body":{"type":"root","children":[{"type":"element","tag":"h2","props":{"id":"介绍"},"children":[{"type":"text","value":"介绍"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"qiankun 是一个基于 "},{"type":"element","tag":"a","props":{"href":"https://github.com/CanopyTax/single-spa","rel":["nofollow"]},"children":[{"type":"text","value":"single-spa"}]},{"type":"text","value":" 的"},{"type":"element","tag":"a","props":{"href":"https://micro-frontends.org/","rel":["nofollow"]},"children":[{"type":"text","value":"微前端实"}]},{"type":"text","value":"现库，旨在帮助大家能更简单、无痛的构建一个生产可用微前端架构系统。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"qiankun 孵化自蚂蚁金融科技基于微前端架构的云产品统一接入平台，在经过一批线上应用的充分检验及打磨后，我们将其微前端内核抽取出来并开源，希望能同时帮助社区有类似需求的系统更方便的构建自己的微前端系统，同时也希望通过社区的帮助将 qiankun 打磨的更加成熟完善。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"目前 qiankun 已在蚂蚁内部服务了超过 200+ 线上应用，在易用性及完备性上，绝对是值得信赖的。"}]},{"type":"element","tag":"h2","props":{"id":"_1主应用"},"children":[{"type":"text","value":"1、主应用"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"主应用不限技术栈，只需要提供一个容器 DOM，然后注册微应用并 start 即可。"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"先安装 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"qiankun"}]},{"type":"text","value":" ："}]},{"type":"element","tag":"pre","props":{"className":["language-js"],"code":"$ yarn add qiankun # 或者 npm i qiankun -S\n","language":"js","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"$ yarn add qiankun # 或者 npm i qiankun -S\n"}]}]},{"type":"element","tag":"h3","props":{"id":"_11注册微应用并启动"},"children":[{"type":"text","value":"1.1、注册微应用并启动："}]},{"type":"element","tag":"pre","props":{"className":["language-js"],"code":"import { registerMicroApps, start } from 'qiankun';\n\nregisterMicroApps([\n  {\n    name: 'reactApp',\n    entry: '//localhost:3000',\n    container: '#container',\n    activeRule: '/app-react',\n  },\n  {\n    name: 'vueApp',\n    entry: '//localhost:8080',\n    container: '#container',\n    activeRule: '/app-vue',\n  },\n  {\n    name: 'angularApp',\n    entry: '//localhost:4200',\n    container: '#container',\n    activeRule: '/app-angular',\n  },\n]);\n// 启动 qiankun\nstart();\n","language":"js","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"import { registerMicroApps, start } from 'qiankun';\n\nregisterMicroApps([\n  {\n    name: 'reactApp',\n    entry: '//localhost:3000',\n    container: '#container',\n    activeRule: '/app-react',\n  },\n  {\n    name: 'vueApp',\n    entry: '//localhost:8080',\n    container: '#container',\n    activeRule: '/app-vue',\n  },\n  {\n    name: 'angularApp',\n    entry: '//localhost:4200',\n    container: '#container',\n    activeRule: '/app-angular',\n  },\n]);\n// 启动 qiankun\nstart();\n"}]}]},{"type":"element","tag":"h2","props":{"id":"_2vue-微应用"},"children":[{"type":"text","value":"2、Vue 微应用"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"以 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"vue-cli 3+"}]},{"type":"text","value":" 生成的 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"vue 2.x"}]},{"type":"text","value":" 项目为例"}]},{"type":"element","tag":"h3","props":{"id":"_21在-src-目录新增-public-pathjs"},"children":[{"type":"text","value":"2.1、在 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"src"}]},{"type":"text","value":" 目录新增 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"public-path.js"}]},{"type":"text","value":"："}]},{"type":"element","tag":"pre","props":{"className":["language-js"],"code":"if (window.__POWERED_BY_QIANKUN__) {\n  __webpack_public_path__ = window.__INJECTED_PUBLIC_PATH_BY_QIANKUN__;\n}\n","language":"js","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"if (window.__POWERED_BY_QIANKUN__) {\n  __webpack_public_path__ = window.__INJECTED_PUBLIC_PATH_BY_QIANKUN__;\n}\n"}]}]},{"type":"element","tag":"h3","props":{"id":"_22入口文件-mainjs-修改为了避免根-id-app-与其他的-dom-冲突需要限制查找范围"},"children":[{"type":"text","value":"2.2、入口文件 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"main.js"}]},{"type":"text","value":" 修改，为了避免根 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"id #app"}]},{"type":"text","value":" 与其他的 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"DOM"}]},{"type":"text","value":" 冲突，需要限制查找范围。"}]},{"type":"element","tag":"pre","props":{"className":["language-js"],"code":"// new Vue({\n//   router,\n//   store,\n//   render: h => h(App)\n// }).$mount('#app')\n\n// 乾坤配置方法\nlet instance = null\nfunction render( props = {}) {\n    const { container } = props\n    instance = new Vue({\n        router,\n        store,\n        render: h => h(App),\n    }).$mount(container ? container.querySelector('#app'): '#app')\n}\n\nif (!window.__POWERED_BY_QIANKUN__) {\n    render()\n}\n\n//--------- 生命周期函数------------//\nexport async function bootstrap() {\n    console.log('[qiankun] vue app bootstraped')\n}\nexport async function mount(props) {\n    console.log('[qiankun] props from main framework', props)\n    render(props)\n}\nexport async function unmount() {\n    instance.$destroy()\n    instance.$el.innerHTML = ''\n    instance = null\n}\n\n","language":"js","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"// new Vue({\n//   router,\n//   store,\n//   render: h => h(App)\n// }).$mount('#app')\n\n// 乾坤配置方法\nlet instance = null\nfunction render( props = {}) {\n    const { container } = props\n    instance = new Vue({\n        router,\n        store,\n        render: h => h(App),\n    }).$mount(container ? container.querySelector('#app'): '#app')\n}\n\nif (!window.__POWERED_BY_QIANKUN__) {\n    render()\n}\n\n//--------- 生命周期函数------------//\nexport async function bootstrap() {\n    console.log('[qiankun] vue app bootstraped')\n}\nexport async function mount(props) {\n    console.log('[qiankun] props from main framework', props)\n    render(props)\n}\nexport async function unmount() {\n    instance.$destroy()\n    instance.$el.innerHTML = ''\n    instance = null\n}\n\n"}]}]},{"type":"element","tag":"h3","props":{"id":"_23配置-vueconfigjs"},"children":[{"type":"text","value":"2.3、配置 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"vue.config.js"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"在子项目内修改 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"vue.config.js"}]}]},{"type":"element","tag":"pre","props":{"className":["language-js"],"code":"const path = require('path');\nconst { name } = require('./package');\n\nfunction resolve(dir) {\n    return path.join(__dirname, dir);\n}\n\nconst port = 8092; // dev port\n\nmodule.exports = {\n  /**\n   * You will need to set publicPath if you plan to deploy your site under a sub path,\n   * for example GitHub Pages. If you plan to deploy your site to https://foo.github.io/bar/,\n   * then publicPath should be set to \"/bar/\".\n   * In most cases please use '/' !!!\n   * Detail: https://cli.vuejs.org/config/#publicpath\n   */\n    // 基本路径\n    publicPath: process.env.publicPath != null && process.env.publicPath != '' ? process.env.publicPath : '/',\n    outputDir: process.env.outputDir != null && process.env.outputDir != '' ? process.env.outputDir : 'dist',\n    filenameHashing: true,\n    // tweak internal webpack configuration.\n    // see https://github.com/vuejs/vue-cli/blob/dev/docs/webpack.md\n    devServer: {\n        // host: '0.0.0.0',\n        hot: true,\n        disableHostCheck: true,\n        port,\n        // overlay: {\n        //     warnings: false,\n        //     errors: true,\n        // },\n        headers: {\n            'Access-Control-Allow-Origin': '*',\n        },\n    },\n    // 自定义webpack配置\n    configureWebpack: {\n        resolve: {\n            alias: {\n                // '@': window.__POWERED_BY_QIANKUN__? resolve('/naroticControl/src'): resolve('/src'),\n                '@': resolve('/src'),\n            },\n        },\n        output: {\n            // 把子应用打包成 umd 库格式\n            library: `${name}-[name]`,\n            libraryTarget: 'umd',\n            jsonpFunction: `webpackJsonp_${name}`,\n        },\n    },\n};\n","language":"js","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"const path = require('path');\nconst { name } = require('./package');\n\nfunction resolve(dir) {\n    return path.join(__dirname, dir);\n}\n\nconst port = 8092; // dev port\n\nmodule.exports = {\n  /**\n   * You will need to set publicPath if you plan to deploy your site under a sub path,\n   * for example GitHub Pages. If you plan to deploy your site to https://foo.github.io/bar/,\n   * then publicPath should be set to \"/bar/\".\n   * In most cases please use '/' !!!\n   * Detail: https://cli.vuejs.org/config/#publicpath\n   */\n    // 基本路径\n    publicPath: process.env.publicPath != null && process.env.publicPath != '' ? process.env.publicPath : '/',\n    outputDir: process.env.outputDir != null && process.env.outputDir != '' ? process.env.outputDir : 'dist',\n    filenameHashing: true,\n    // tweak internal webpack configuration.\n    // see https://github.com/vuejs/vue-cli/blob/dev/docs/webpack.md\n    devServer: {\n        // host: '0.0.0.0',\n        hot: true,\n        disableHostCheck: true,\n        port,\n        // overlay: {\n        //     warnings: false,\n        //     errors: true,\n        // },\n        headers: {\n            'Access-Control-Allow-Origin': '*',\n        },\n    },\n    // 自定义webpack配置\n    configureWebpack: {\n        resolve: {\n            alias: {\n                // '@': window.__POWERED_BY_QIANKUN__? resolve('/naroticControl/src'): resolve('/src'),\n                '@': resolve('/src'),\n            },\n        },\n        output: {\n            // 把子应用打包成 umd 库格式\n            library: `${name}-[name]`,\n            libraryTarget: 'umd',\n            jsonpFunction: `webpackJsonp_${name}`,\n        },\n    },\n};\n"}]}]},{"type":"element","tag":"h3","props":{"id":"_24配置子项目的-router"},"children":[{"type":"text","value":"2.4、配置子项目的 router"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"修改输出的目录，需要和主应用的 "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"activeRule"}]},{"type":"text","value":" 一致"}]},{"type":"element","tag":"pre","props":{"className":["language-js"],"code":"const router = new VueRouter({\n    mode: 'history',\n    base: window.__POWERED_BY_QIANKUN__? '/app-vue/': process.env.BASE_URL,\n    routes\n})\n","language":"js","meta":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"text","value":"const router = new VueRouter({\n    mode: 'history',\n    base: window.__POWERED_BY_QIANKUN__? '/app-vue/': process.env.BASE_URL,\n    routes\n})\n"}]}]},{"type":"element","tag":"h2","props":{"id":"为什么不是-iframe"},"children":[{"type":"text","value":"为什么不是 iframe"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"看这里 "},{"type":"element","tag":"a","props":{"href":"https://www.yuque.com/kuitos/gky7yw/gesexv","rel":["nofollow"]},"children":[{"type":"text","value":"Why Not Iframe"}]}]},{"type":"element","tag":"h2","props":{"id":"特性"},"children":[{"type":"text","value":"特性"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"📦 基于 "},{"type":"element","tag":"a","props":{"href":"https://github.com/CanopyTax/single-spa","rel":["nofollow"]},"children":[{"type":"text","value":"single-spa"}]},{"type":"text","value":" 封装，提供了更加开箱即用的 API。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"📱 技术栈无关，任意技术栈的应用均可 使用/接入，不论是 React/Vue/Angular/JQuery 还是其他等框架。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"💪 HTML Entry 接入方式，让你接入微应用像使用 iframe 一样简单。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"🛡​ 样式隔离，确保微应用之间样式互相不干扰。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"🧳 JS 沙箱，确保微应用之间 全局变量/事件 不冲突。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"⚡️ 资源预加载，在浏览器空闲时间预加载未打开的微应用资源，加速微应用打开速度。"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"🔌 umi 插件，提供了 "},{"type":"element","tag":"a","props":{"href":"https://github.com/umijs/plugins/tree/master/packages/plugin-qiankun","rel":["nofollow"]},"children":[{"type":"text","value":"@umijs/plugin-qiankun"}]},{"type":"text","value":" 供 umi 应用一键切换成微前端架构系统。"}]}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"介绍","depth":2,"text":"介绍"},{"id":"_1主应用","depth":2,"text":"1、主应用","children":[{"id":"_11注册微应用并启动","depth":3,"text":"1.1、注册微应用并启动："}]},{"id":"_2vue-微应用","depth":2,"text":"2、Vue 微应用","children":[{"id":"_21在-src-目录新增-public-pathjs","depth":3,"text":"2.1、在 src 目录新增 public-path.js："},{"id":"_22入口文件-mainjs-修改为了避免根-id-app-与其他的-dom-冲突需要限制查找范围","depth":3,"text":"2.2、入口文件 main.js 修改，为了避免根 id #app 与其他的 DOM 冲突，需要限制查找范围。"},{"id":"_23配置-vueconfigjs","depth":3,"text":"2.3、配置 vue.config.js"},{"id":"_24配置子项目的-router","depth":3,"text":"2.4、配置子项目的 router"}]},{"id":"为什么不是-iframe","depth":2,"text":"为什么不是 iframe"},{"id":"特性","depth":2,"text":"特性"}]}},"_type":"markdown","_id":"content:posts:20211028.md","_source":"content","_file":"posts/20211028.md","_stem":"posts/20211028","_extension":"md"}